# AI恋人 - 优化建议与上线前检查清单

## 一、已完成的优化

### 1. AI交互真实感优化
- ✅ **去掉AI开场白**：不再让AI主动先说话，让玩家先开口，符合真实社交场景
- ✅ **阶段性主动性调整**：
  - 陌生人阶段：AI回复简短克制，不主动提问，保持社交距离
  - 初识阶段：稍微放松，但仍有保留
  - 熟悉/好友阶段：自然交流，偶尔主动分享
  - 暧昧/表白阶段：明显更主动，在意对方感受
  - 恋人/婚后阶段：非常主动，经常关心和分享

### 2. 敏感词过滤功能
- ✅ **客户端过滤**：在发送消息前检测敏感词，即时拦截
- ✅ **服务端过滤**：云函数中增加敏感词检测，双重保障
- ✅ **分类管理**：敏感词按色情、暴力、政治、违法、歧视等分类管理

---

## 二、仍需优化的功能

### 1. AI回复质量
- [ ] **记忆连贯性**：当前仅保留最近20轮对话上下文，长期记忆依赖relationship_summary字段，建议增加关键信息自动提取与摘要更新机制
- [ ] **情感表达多样性**：当前情绪类型仅6种(happy/shy/sad/angry/neutral/surprised)，可增加更细腻的情绪（如担忧、思念、吃醋等）
- [ ] **回复防重复**：AI可能在不同轮次给出相似回复，建议增加"避免重复已说过的内容"的提示词
- [ ] **话题深度**：在好友阶段以上，AI应该能记住之前讨论过的话题，并在后续对话中引用

### 2. 游戏体验
- [ ] **新手引导**：首次进入聊天页面时缺少操作引导，建议添加简单的新手提示（如"试着跟TA打个招呼吧"）
- [ ] **离线消息**：用户长时间未上线时，AI可以准备一条"想你了"之类的离线消息，增强代入感
- [ ] **特殊日期**：在节日（情人节、七夕等）或纪念日时，AI主动给出特殊回复
- [ ] **冷场恢复**：当对话陷入僵局时，AI应有能力通过提起之前的话题来恢复聊天氛围

### 3. 数值系统
- [ ] **好感度衰减**：长时间不聊天时好感度应缓慢下降，增加用户黏性
- [ ] **情绪影响**：AI当前的情绪状态应影响下一轮回复的基调
- [ ] **差异化成长曲线**：不同性格的角色对不同话题的好感度增长速率应有差异

### 4. UI/UX优化
- [ ] **表情系统**：根据AI返回的emotion字段，在头像旁展示对应表情动画
- [ ] **语音消息**：集成TTS（文字转语音），让AI恋人可以"说话"
- [ ] **时间线**：在对话页面展示关系发展的关键时间节点
- [ ] **日间/夜间模式**：根据用户当前时间自动切换聊天氛围（白天/夜晚背景）

---

## 三、上线前必须完成的事项

### 1. 安全与合规 🔴 关键
- [ ] **API Key保护**：将`config/api.js`中硬编码的API Key移除，全部通过uniCloud云函数环境变量配置，禁止客户端暴露API Key
- [ ] **内容安全审核**：接入平台内容安全API（如微信内容安全接口`security.msgSecCheck`），对AI回复也进行二次审核
- [ ] **用户协议与隐私政策**：编写并展示用户协议、隐私政策文档，符合应用商店和小程序平台上线要求
- [ ] **实名认证/年龄验证**：恋爱类游戏可能需要年龄验证，确保未成年人保护合规
- [ ] **敏感词库持续更新**：建立敏感词动态更新机制（通过云端配置而非本地硬编码）
- [ ] **数据加密**：用户聊天记录等敏感数据应加密存储

### 2. 性能优化 🟡 重要
- [ ] **云函数冷启动优化**：首次调用云函数可能有延迟，建议使用云函数预热或单实例模式
- [ ] **对话历史分页加载**：当前一次性加载全部聊天历史，大量消息时会卡顿，需实现分页加载
- [ ] **图片资源优化**：角色头像等静态资源应压缩并使用CDN加速
- [ ] **接口超时处理**：AI API调用可能超时，需要设置合理的超时时间和重试机制

### 3. 功能完善 🟡 重要
- [ ] **广告配置**：替换所有`YOUR_*_ADPID`占位符为真实广告位ID
- [ ] **客户端/服务端双写一致性**：当前客户端和云函数各维护一套数据逻辑，建议统一为云函数处理，客户端仅做展示
- [ ] **异常处理增强**：网络断开、AI接口异常、数据库操作失败等场景需要更完善的错误处理和用户提示
- [ ] **数据备份方案**：用户数据定期备份策略

### 4. 测试 🟡 重要
- [ ] **单元测试**：为核心逻辑（好感度计算、阶段推进、敏感词过滤）编写单元测试
- [ ] **压力测试**：模拟高并发场景下云函数和AI API的响应情况
- [ ] **兼容性测试**：在微信小程序、抖音小程序、H5等多平台测试
- [ ] **边界测试**：测试各阶段边界值、极端输入（超长文本、特殊字符、空消息等）

### 5. 平台审核准备 🟢 建议
- [ ] **微信小程序审核材料**：准备类目资质、游戏类目所需文件
- [ ] **抖音小程序审核材料**：准备相关资质文件
- [ ] **应用商店截图**：准备各平台要求的应用截图和描述
- [ ] **版本号管理**：设置正式版本号和更新日志

### 6. 运营准备 🟢 建议
- [ ] **数据统计**：集成用户行为统计（DAU、留存率、付费转化等）
- [ ] **反馈渠道**：提供用户反馈和问题举报入口
- [ ] **公告系统**：维护公告和版本更新通知功能
- [ ] **客服支持**：建立用户客服支持渠道

---

## 四、优先级排序

| 优先级 | 事项 | 说明 |
|--------|------|------|
| P0 | API Key安全 | 必须在上线前完成，否则有资金损失风险 |
| P0 | 内容安全审核 | 平台审核必备，合规要求 |
| P0 | 用户协议/隐私政策 | 平台上线硬性要求 |
| P1 | 广告位配置 | 直接影响收入 |
| P1 | 异常处理增强 | 影响用户体验 |
| P1 | 兼容性测试 | 确保多平台正常运行 |
| P2 | 新手引导 | 提升新用户留存 |
| P2 | 性能优化 | 提升使用体验 |
| P3 | 情绪系统丰富 | 锦上添花 |
| P3 | 语音/表情功能 | 后续版本迭代 |
