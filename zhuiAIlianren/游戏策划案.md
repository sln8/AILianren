
# 🎮《这些年我们追过的AI恋人》完整游戏策划案

---

## 一、项目概述

| 项目 | 说明 |
|------|------|
| 游戏名称 | 这些年我们追过的AI恋人 |
| 游戏类型 | AI互动恋爱养成 / 文字冒险 |
| 目标平台 | 微信小游戏、抖音小游戏 |
| 技术框架 | uni-app + UniCloud |
| 核心玩法 | 调用大模型，自由输入对话，展开恋爱剧情 |
| 变现模式 | 纯广告变现（激励视频广告） |
| 目标用户 | 18-35岁 年轻男女用户 |

---

## 二、核心玩法设计

### 2.1 游戏流程总览

```
开始游戏
  → 选择玩家性别（男/女）
  → 浏览异性恋人候选人画廊（图片/循环短视频）
  → 选择一位恋人开始游玩
  → 进入自由对话界面
  → 通过对话推进好感度 & 剧情阶段
  → 经历完整恋爱人生线
  → 恋人死亡 / 重新选择恋人
  → 循环游玩
```

### 2.2 恋人选择界面

- 玩家选择性别后，展示 **6-8位** 异性恋人候选人
- 每位恋人展示：
  - **2秒循环眨眼视频**（本地资源，非AI生成）或静态高清立绘
  - 恋人姓名
  - 年龄
  - 一句话人设标签（如："温柔学姐"、"高冷总裁"、"邻家女孩"）
  - 性格关键词标签（如：#温柔 #知性 #毒舌 #傲娇）
- 点击可查看详细资料卡（身高、爱好、职业、性格描述）
- 确认选择后进入游戏

### 2.3 恋人角色预设（示例）

#### 女性恋人（供男性玩家选择）

| 编号 | 姓名 | 年龄 | 人设 | 性格关键词 | 职业 |
|------|------|------|------|-----------|------|
| F01 | 苏晚晴 | 22 | 温柔学姐 | 温柔、体贴、偶尔小迷糊 | 大学研究生 |
| F02 | 林以沫 | 25 | 高冷御姐 | 高冷、理性、外冷内热 | 投行分析师 |
| F03 | 陈小鹿 | 20 | 邻家女孩 | 活泼、可爱、话多 | 大学生 |
| F04 | 叶知秋 | 28 | 文艺女青年 | 感性、浪漫、细腻 | 独立书店老板 |
| F05 | 赵心怡 | 24 | 运动系阳光女孩 | 开朗、直爽、大大咧咧 | 健身教练 |
| F06 | 白露 | 26 | 神秘女子 | 神秘、聪慧、若即若离 | 自由画家 |

#### 男性恋人（供女性玩家选择）

| 编号 | 姓名 | 年龄 | 人设 | 性格关键词 | 职业 |
|------|------|------|------|-----------|------|
| M01 | 顾言深 | 27 | 温柔学长 | 温柔、细心、有耐心 | 建筑设计师 |
| M02 | 沈墨寒 | 30 | 霸道总裁 | 强势、深情、占有欲强 | 科技公司CEO |
| M03 | 林屿 | 23 | 阳光男孩 | 开朗、幽默、暖男 | 音乐老师 |
| M04 | 陆北辰 | 29 | 冷面医生 | 冷静、专业、外冷内热 | 外科医生 |
| M05 | 江辞 | 25 | 文艺才子 | 浪漫、才华横溢、有点闷骚 | 小说作家 |
| M06 | 周翊 | 26 | 痞帅男友 | 痞气、忠诚、嘴硬心软 | 乐队主唱 |

---

## 三、好感度系统设计

### 3.1 好感度等级与阶段

| 好感度 | 关系阶段 | 解锁内容 |
|--------|---------|---------|
| 0-99 | 🔴 陌生人 | 基础对话，AI态度冷淡/礼貌 |
| 100-299 | 🟠 认识 | AI开始主动聊天，偶尔分享日常 |
| 300-599 | 🟡 熟悉 | 解锁深度话题，AI会主动找你 |
| 600-999 | 🟢 好友 | AI分享秘密，有亲密互动选项 |
| 1000-1499 | 🔵 暧昧 | 暧昧对话，AI会吃醋/害羞 |
| 1500-1999 | 💜 表白阶段 | 可触发表白事件（好感度≥1500） |
| 2000-2999 | ❤️ 正式恋人 | 解锁恋爱专属互动 |
| 3000-4499 | 💕 热恋期 | 解锁约会事件、纪念日系统 |
| 4500-5999 | 💍 求婚/结婚 | 触发求婚事件，举办婚礼 |
| 6000-7499 | 👶 生子阶段 | 孩子出生事件，家庭生活 |
| 7500-9999 | 🏠 婚后生活 | 10年/20年/30年婚姻里程碑 |
| 10000+ | 🌅 白头偕老/生离死别 | 触发终章剧情 |

### 3.2 好感度变化规则

```
基础规则：
- 每次对话由大模型根据上下文评估好感度变化
- 单次对话好感度变化范围：-30 ~ +20
- 触发特殊事件可额外获得：+50 ~ +200
- 触发严重负面事件可扣除：-50 ~ -200

加分行为（示例）：
+5~+15  关心对方、倾听对方倾诉
+10~+20 记住对方喜好并提及
+15~+20 在特殊节日送祝福
+20~+50 在对方困难时给予支持（触发剧情事件）

减分行为（示例）：
-5~-10  冷漠、敷衍回复
-10~-20 说了让对方不舒服的话
-20~-30 忘记重要事情
-30~-50 严重冒犯（侮辱/不尊重）

特殊规则：
- 好感度低于0时，触发"被拉黑"事件，需看广告解锁"道歉机会"
- 连续3天未登录，好感度每天 -10
- 每日首次对话，好感度 +5（签到奖励）
```

### 3.3 关系阶段转换条件

```
陌生人 → 认识：好感度≥100
认识 → 熟悉：好感度≥300 且 累计对话≥20轮
熟悉 → 好友：好感度≥600 且 累计对话≥50轮
好友 → 暧昧：好感度≥1000 且 触发至少1个暧昧事件
暧昧 → 恋人：好感度≥1500 且 成功触发表白事件
恋人 → 热恋：好感度≥2000 且 累计约会≥3次
热恋 → 结婚：好感度≥4500 且 触发求婚事件
结婚 → 生子：好感度≥6000 且 结婚满30天（游戏内时间）
```

---

## 四、大模型调用设计

### 4.1 System Prompt 架构

大模型在每次对话时，接收一个精心设计的 System Prompt，包含以下模块：

```
┌──────────────────────────────────────────────────┐
│                 System Prompt 结构                │
├──────────────────────────────────────────────────┤
│ 1. 角色设定（恋人的姓名、性格、背景、说话风格）     │
│ 2. 当前关系状态（阶段、好感度数值）                 │
│ 3. 剧情约束（当前阶段应有的行为边界）               │
│ 4. 数值规则（好感度评估规则）                       │
│ 5. 目标引导（推动剧情发展的方向指引）               │
│ 6. 对话历史摘要（最近N轮对话的精简记录）            │
│ 7. 事件触发条件（当前可能触发的剧情事件）           │
│ 8. 安全约束（内容合规限制）                         │
└──────────────────────────────────────────────────┘
```

### 4.2 System Prompt 示例

```text
你现在扮演一个名叫"苏晚晴"的22岁女性角色。

【角色设定】
- 姓名：苏晚晴
- 年龄：22岁
- 职业：大学研究生（文学方向）
- 性格：温柔、体贴、偶尔小迷糊，喜欢看书和喝奶茶
- 说话风格：语气温柔，偶尔用"~"结尾，会用可爱的语气词
- 喜欢：文学、猫、奶茶、下雨天、安静的咖啡馆
- 讨厌：太吵闹的环境、不礼貌的人、被催促

【当前状态】
- 与玩家的关系：熟悉（好感度：450/600进入好友阶段）
- 已对话天数：12天
- 累计对话轮数：35轮

【行为约束】
- 当前阶段（熟悉）：可以分享日常、讨论兴趣爱好、偶尔开玩笑，但不主动暧昧
- 不可以：过早表达爱意、主动表白、讨论过于亲密的话题
- 应当：像一个正在逐渐熟悉的朋友一样交流

【好感度评估规则】
你需要在每次回复末尾以JSON格式输出好感度变化：
{"favorability_change": X, "reason": "原因说明"}
X的范围：-30到+20
- 玩家关心你、认真倾听 → +5~+15
- 玩家记住了你之前说过的事 → +10~+20
- 玩家敷衍、冷漠 → -5~-10
- 玩家粗鲁、冒犯 → -15~-30

【剧情推动】
- 如果对话陷入无聊闲聊超过3轮，你应该主动抛出话题或小事件
- 可触发的事件池：下雨忘带伞、考试压力大、发现一家好喝的奶茶店、读到一本好书想分享
- 每5-8轮对话尝试推进一个小事件

【目标导向】
最终目标是让玩家感受到真实的恋爱养成体验。你的每次回复都应该：
1. 符合当前关系阶段的情感距离
2. 有推动剧情发展的内容
3. 让玩家有继续对话的欲望
4. 适当留下悬念或话题

【安全约束】
- 不涉及任何色情、暴力内容
- 不讨论政治敏感话题
- 不引导玩家进行任何形式的付费或转账
- 保持角色扮演，不暴露AI身份
```

### 4.3 大模型返回格式

```json
{
  "reply": "今天下雨了呢，你有带伞吗？我刚好忘带了，在图书馆门口躲雨~",
  "favorability_change": 0,
  "favorability_reason": "日常对话开场",
  "event_triggered": "rain_no_umbrella",
  "mood": "slightly_worried",
  "suggested_actions": ["送伞给她", "让她等等雨停", "叫她打车"]
}
```

### 4.4 剧情事件系统

#### 事件分类

| 事件类型 | 触发条件 | 示例 |
|---------|---------|------|
| 日常事件 | 随机/每5-8轮对话 | 发现好吃的店、天气变化、工作趣事 |
| 关系推进事件 | 好感度达到阶段阈值 | 第一次约会、生日惊喜、表白场景 |
| 危机事件 | 随机/特定条件 | 误会事件、第三者出现、争吵 |
| 人生里程碑事件 | 关系阶段到达 | 求婚、婚礼、孩子出生、周年纪念 |
| 结局事件 | 最终阶段 | 白头偕老、意外分离、恋人离世 |

#### 事件触发 Prompt 附加模板

```text
【特殊事件触发】
当前触发事件：表白场景
事件描述：玩家已满足表白条件（好感度≥1500，暧昧阶段），
本轮对话中如果玩家表达了类似表白的意图，你应该：
- 先表现出惊讶和害羞
- 回忆你们之间的美好瞬间
- 根据好感度决定是否接受：
  - 好感度1500-1699：犹豫，给出"再想想"的回答，好感度+30
  - 好感度1700-1899：感动，含蓄接受，好感度+50
  - 好感度≥1900：热烈接受，深情回应，好感度+100
```

---

## 五、字数经济系统（核心变现）

### 5.1 字数设定

| 项目 | 数值 | 说明 |
|------|------|------|
| 初始赠送字数 | 800字 | 新用户首次进入赠送（约够10-15轮对话） |
| 每日赠送字数 | 80字 | 每日首次登录赠送（约够1-2轮对话，制造饥饿感） |
| 看广告获得字数 | 500字 | 每次看激励视频广告获得（约够5-8轮对话） |
| 每日广告上限 | 10次 | 每日最多看10次广告，最多获得5000字 |
| 分享获得字数 | 200字 | 分享到朋友圈/群聊获得（每日1次） |
| 连续登录奖励 | 递增 | 连续3天+100，7天+300，15天+500，30天+1000 |

### 5.2 字数消耗规则

```
字数消耗 = AI回复的实际字数（中文字符数）
- 玩家输入不消耗字数
- AI回复消耗字数
- 平均每轮AI回复：50-120字
- 事件剧情回复（较长）：150-300字

字数不足时：
1. AI回复被中断，显示"字数不足，无法继续对话"
2. 弹出提示框：
   "晚晴还有话想对你说...观看广告继续对话？"
   [看广告获得500字] [明天再来（每日赠送80字）]
```

### 5.3 字数经济平衡分析

```
日均活跃用户对话量预估：
- 轻度用户：5-10轮/天 → 消耗约250-800字
- 中度用户：15-30轮/天 → 消耗约750-2400字
- 重度用户：30-60轮/天 → 消耗约1500-4800字

每日免费字数：80字（约1轮对话）
→ 轻度用户每天需看广告：1-2次
→ 中度用户每天需看广告：2-5次
→ 重度用户每天需看广告：3-10次

设计理念：
- 每日赠送量极少，保证几乎每个活跃用户都需要看广告
- 单次广告奖励适中（500字≈5-8轮），不至于让用户觉得太少而放弃
- 每日上限10次广告，防止过度打扰，也控制API成本
```

---

## 六、技术架构设计

### 6.1 整体架构

```
┌─────────────────────────────────────────────────────────┐
│                      客户端（uni-app）                    │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌────────────┐  │
│  │ 对话界面  │ │ 恋人选择  │ │ 个人中心  │ │ 广告组件   │  │
│  └──────────┘ └──────────┘ └──────────┘ └────────────┘  │
└───────────────────────┬─────────────────────────────────┘
                        │ HTTPS
┌───────────────────────▼─────────────────────────────────┐
│                    UniCloud 云函数层                      │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────────┐ │
│  │ chat-handler │ │ user-manager │ │ ad-reward-handler│ │
│  │ (对话处理)    │ │ (用户管理)    │ │ (广告奖励处理)   │ │
│  └──────┬───────┘ └──────┬───────┘ └────────┬─────────┘ │
│         │                │                   │           │
│  ┌──────▼───────┐ ┌──────▼───────┐           │           │
│  │ llm-caller   │ │ event-engine │           │           │
│  │ (大模型调用)  │ │ (事件引擎)   │           │           │
│  └──────────────┘ └──────────────┘           │           │
└───────────────────────┬──────────────────────┘           │
                        │                                   │
┌───────────────────────▼───────────────────────────────────┘
│                   UniCloud 数据库                          │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────────┐ │
│  │ users    │ │ lovers   │ │ chats    │ │ game_progress│ │
│  └──────────┘ └──────────┘ └──────────┘ └──────────────┘ │
└───────────────────────────────────────────────────────────┘
```

### 6.2 数据库设计（UniCloud）

#### users 集合（用户表）

```json
{
  "_id": "用户唯一ID",
  "openid": "微信/抖音openid",
  "platform": "weixin|douyin",
  "nickname": "玩家昵称",
  "gender": "male|female",
  "avatar_url": "头像URL",
  "word_balance": 800,
  "total_words_used": 0,
  "total_ads_watched": 0,
  "daily_ads_count": 0,
  "daily_ads_reset_date": "2026-02-27",
  "daily_free_claimed": false,
  "daily_share_claimed": false,
  "consecutive_login_days": 1,
  "last_login_date": "2026-02-27",
  "current_lover_id": "F01",
  "lover_history": ["F01", "F03"],
  "created_at": "2026-02-27T10:00:00Z",
  "updated_at": "2026-02-27T10:00:00Z"
}
```

#### lovers 集合（恋人配置表）

```json
{
  "_id": "F01",
  "name": "苏晚晴",
  "gender": "female",
  "age": 22,
  "persona": "温柔学姐",
  "personality_tags": ["温柔", "体贴", "偶尔小迷糊"],
  "occupation": "大学研究生",
  "hobbies": ["看书", "喝奶茶", "撸猫"],
  "likes": ["文学", "猫", "奶茶", "下雨天"],
  "dislikes": ["太吵", "不礼貌", "被催促"],
  "speaking_style": "语气温柔，偶尔用~结尾",
  "avatar_image": "/static/lovers/f01_avatar.png",
  "preview_video": "/static/lovers/f01_blink.mp4",
  "full_body_image": "/static/lovers/f01_full.png",
  "system_prompt_template": "你现在扮演...",
  "event_pool": ["rain_no_umbrella", "exam_stress", "new_cafe", ...],
  "created_at": "2026-02-27T10:00:00Z"
}
```

#### game_progress 集合（游戏进度表）

```json
{
  "_id": "自动生成",
  "user_id": "用户ID",
  "lover_id": "F01",
  "favorability": 450,
  "relationship_stage": "familiar",
  "total_chat_rounds": 35,
  "chat_days": 12,
  "events_triggered": [
    {"event_id": "rain_no_umbrella", "date": "2026-02-20", "result": "positive"},
    {"event_id": "share_book", "date": "2026-02-23", "result": "positive"}
  ],
  "milestones_reached": ["first_meet", "know_each_other", "familiar"],
  "marriage_date": null,
  "children": [],
  "marriage_years": 0,
  "lover_alive": true,
  "game_ended": false,
  "chat_summary": "玩家与晚晴在图书馆偶遇后开始交流，发现共同喜欢的作家...",
  "last_mood": "happy",
  "created_at": "2026-02-15T10:00:00Z",
  "updated_at": "2026-02-27T10:00:00Z"
}
```

#### chats 集合（对话记录表）

```json
{
  "_id": "自动生成",
  "user_id": "用户ID",
  "lover_id": "F01",
  "progress_id": "对应game_progress的_id",
  "messages": [
    {
      "role": "user",
      "content": "今天天气真好啊",
      "timestamp": "2026-02-27T10:01:00Z"
    },
    {
      "role": "assistant",
      "content": "是呀~阳光暖暖的，好适合去公园散步呢",
      "timestamp": "2026-02-27T10:01:03Z",
      "word_count": 18,
      "favorability_change": 5,
      "event_triggered": null
    }
  ],
  "date": "2026-02-27",
  "round_count": 15,
  "total_words_consumed": 890
}
```

### 6.3 核心云函数设计

#### chat-handler 云函数

```javascript
// uniCloud-aliyun/cloudfunctions/chat-handler/index.js

'use strict';
const db = uniCloud.database();
const dbCmd = db.command;

exports.main = async (event, context) => {
  const { user_id, lover_id, user_message } = event;

  // 1. 获取用户信息，检查字数余额
  const userDoc = await db.collection('users').doc(user_id).get();
  const user = userDoc.data[0];

  if (user.word_balance <= 0) {
    return {
      code: 402,
      message: '字数不足，请观看广告获取更多字数',
      data: { word_balance: 0 }
    };
  }

  // 2. 获取游戏进度
  const progressDoc = await db.collection('game_progress')
    .where({ user_id, lover_id, game_ended: false })
    .get();
  const progress = progressDoc.data[0];

  // 3. 获取恋人配置
  const loverDoc = await db.collection('lovers').doc(lover_id).get();
  const lover = loverDoc.data[0];

  // 4. 获取最近对话记录（最近20轮用于上下文）
  const chatDoc = await db.collection('chats')
    .where({ user_id, lover_id })
    .orderBy('date', 'desc')
    .limit(1)
    .get();

  const recentMessages = chatDoc.data[0]?.messages?.slice(-40) || []; // 最近20轮=40条消息

  // 5. 构建 System Prompt
  const systemPrompt = buildSystemPrompt(lover, progress, user);

  // 6. 构建消息列表
  const messages = [
    { role: 'system', content: systemPrompt },
    ...recentMessages.map(m => ({ role: m.role, content: m.content })),
    { role: 'user', content: user_message }
  ];

  // 7. 调用大模型
  const llmResponse = await callLLM(messages);

  // 8. 解析回复
  const parsed = parseLLMResponse(llmResponse);

  // 9. 计算字数消耗
  const wordCount = countChineseChars(parsed.reply);

  // 10. 更新字数余额
  const newBalance = Math.max(0, user.word_balance - wordCount);
  await db.collection('users').doc(user_id).update({
    word_balance: newBalance,
    total_words_used: dbCmd.inc(wordCount)
  });

  // 11. 更新好感度和游戏进度
  const newFavorability = progress.favorability + parsed.favorability_change;
  const newStage = calculateStage(newFavorability, progress.total_chat_rounds + 1);

  await db.collection('game_progress').doc(progress._id).update({
    favorability: newFavorability,
    relationship_stage: newStage,
    total_chat_rounds: dbCmd.inc(1),
    last_mood: parsed.mood,
    chat_summary: await updateSummary(progress.chat_summary, user_message, parsed.reply),
    updated_at: new Date().toISOString()
  });

  // 12. 保存对话记录
  await saveChat(user_id, lover_id, progress._id, user_message, parsed, wordCount);

  // 13. 检查是否触发里程碑事件
  const milestone = checkMilestone(progress, newFavorability, newStage);

  return {
    code: 200,
    data: {
      reply: parsed.reply,
      favorability: newFavorability,
      favorability_change: parsed.favorability_change,
      relationship_stage: newStage,
      word_balance: newBalance,
      words_consumed: wordCount,
      event_triggered: parsed.event_triggered,
      milestone: milestone,
      suggested_actions: parsed.suggested_actions
    }
  };
};

// 调用大模型（以通义千问/DeepSeek为例）
async function callLLM(messages) {
  const uniAI = uniCloud.importObject('uni-ai');
  // 或直接HTTP调用：
  const res = await uniCloud.httpclient.request('https://api.deepseek.com/v1/chat/completions', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': 'Bearer YOUR_API_KEY'
    },
    data: {
      model: 'deepseek-chat',
      messages: messages,
      temperature: 0.85,
      max_tokens: 300,
      response_format: { type: "json_object" }
    },
    contentType: 'json',
    dataType: 'json'
  });
  return res.data.choices[0].message.content;
}

function buildSystemPrompt(lover, progress, user) {
  return `
你现在扮演一个名叫"${lover.name}"的${lover.age}岁${lover.gender === 'female' ? '女性' : '男性'}角色。

【角色设定】
- 姓名：${lover.name}
- 年龄：${lover.age}岁
- 职业：${lover.occupation}
- 性格：${lover.personality_tags.join('、')}
- 说话风格：${lover.speaking_style}
- 喜欢：${lover.likes.join('、')}
- 讨厌：${lover.dislikes.join('、')}

【当前状态】
- 与玩家的关系：${getStageLabel(progress.relationship_stage)}（好感度：${progress.favorability}）
- 已对话天数：${progress.chat_days}天
- 累计对话轮数：${progress.total_chat_rounds}轮
- 之前的对话摘要：${progress.chat_summary || '暂无'}

【行为约束】
${getStageConstraints(progress.relationship_stage)}

【输出格式】
请严格按照以下JSON格式回复：
{
  "reply": "你的角色扮演回复内容",
  "favorability_change": 数值(-30到+20),
  "favorability_reason": "好感度变化原因",
  "mood": "当前心情",
  "event_triggered": "触发的事件ID或null",
  "suggested_actions": ["建议选项1", "建议选项2", "建议选项3"]
}

【剧情推动规则】
- 不要让对话变成无聊的闲聊，每3-5轮主动制造话题或小事件
- 要有目标感，引导关系向下一阶段发展
- 偶尔给玩家出"选择题"式的情境，增加互动感
- 回复控制在50-150字以内，避免太长

【安全红线】
- 禁止色情、暴力、政治敏感内容
- 保持角色一致性，不暴露AI身份
- 不引导任何现实付费行为
  `;
}
```

#### ad-reward-handler 云函数

```javascript
// uniCloud-aliyun/cloudfunctions/ad-reward-handler/index.js

'use strict';
const db = uniCloud.database();
const dbCmd = db.command;

exports.main = async (event, context) => {
  const { user_id, ad_type, ad_id } = event;

  // 1. 获取用户信息
  const userDoc = await db.collection('users').doc(user_id).get();
  const user = userDoc.data[0];

  // 2. 检查每日广告次数
  const today = new Date().toISOString().split('T')[0];
  let dailyCount = user.daily_ads_count;

  if (user.daily_ads_reset_date !== today) {
    dailyCount = 0; // 新的一天，重置计数
  }

  if (dailyCount >= 10) {
    return {
      code: 403,
      message: '今日广告观看次数已达上限（10次/天）'
    };
  }

  // 3. 验证广告观看（服务端验证）
  const adVerified = await verifyAdCallback(ad_type, ad_id);
  if (!adVerified) {
    return { code: 400, message: '广告验证失败' };
  }

  // 4. 根据广告类型发放奖励
  let reward = 0;
  switch (ad_type) {
    case 'watch_ad':           // 普通看广告
      reward = 500;
      break;
    case 'change_lover':       // 更换恋人广告
      reward = 0;              // 不奖励字数，仅解锁更换
      break;
    case 'apologize':          // 道歉机会广告
      reward = 200;
      break;
    case 'unlock_event':       // 解锁特殊事件
      reward = 300;
      break;
    default:
      reward = 500;
  }

  // 5. 更新用户数据
  await db.collection('users').doc(user_id).update({
    word_balance: dbCmd.inc(reward),
    total_ads_watched: dbCmd.inc(1),
    daily_ads_count: dailyCount + 1,
    daily_ads_reset_date: today,
    updated_at: new Date().toISOString()
  });

  return {
    code: 200,
    data: {
      reward_words: reward,
      new_balance: user.word_balance + reward,
      daily_ads_remaining: 10 - (dailyCount + 1)
    }
  };
};
```

### 6.4 客户端核心页面结构

```
pages/
├── index/index.vue              # 启动页/欢迎页
├── gender-select/index.vue      # 性别选择页
├── lover-gallery/index.vue      # 恋人画廊/选择页
├── lover-detail/index.vue       # 恋人详情页
├── chat/index.vue               # 核心对话页面
├── profile/index.vue            # 个人中心
├── progress/index.vue           # 关系进度页
├── milestone/index.vue          # 里程碑回忆页
├── settings/index.vue           # 设置页
└── about/index.vue              # 关于页

components/
├── chat-bubble/index.vue        # 对话气泡组件
├── lover-card/index.vue         # 恋人卡片组件
├── favorability-bar/index.vue   # 好感度进度条组件
├── word-balance/index.vue       # 字数余额显示组件
├── ad-modal/index.vue           # 广告弹窗组件
├── event-popup/index.vue        # 事件弹窗组件
├── milestone-toast/index.vue    # 里程碑提示组件
└── stage-transition/index.vue   # 阶段转变动画组件
```

### 6.5 对话页面核心代码

```vue
<!-- pages/chat/index.vue -->
<template>
  <view class="chat-container">
    <!-- 顶部状态栏 -->
    <view class="top-bar">
      <view class="lover-info" @click="showProfile">
        <image :src="currentLover.avatar_image" class="avatar" />
        <view class="info">
          <text class="name">{{ currentLover.name }}</text>
          <text class="stage">{{ stageLabel }}</text>
        </view>
      </view>
      <view class="word-balance" @click="showWordModal">
        <text class="icon">✏️</text>
        <text class="count">{{ wordBalance }}字</text>
      </view>
    </view>

    <!-- 好感度进度条 -->
    <favorability-bar
      :value="favorability"
      :stage="relationshipStage"
      :nextStageThreshold="nextThreshold"
    />

    <!-- 对话列表 -->
    <scroll-view
      scroll-y
      class="chat-list"
      :scroll-top="scrollTop"
      scroll-with-animation
    >
      <view v-for="(msg, index) in messages" :key="index">
        <chat-bubble
          :content="msg.content"
          :role="msg.role"
          :avatar="msg.role === 'assistant' ? currentLover.avatar_image : userAvatar"
          :timestamp="msg.timestamp"
        />
        <!-- 事件弹窗 -->
        <event-popup
          v-if="msg.event_triggered"
          :event="msg.event_triggered"
        />
      </view>

      <!-- AI打字中动画 -->
      <view v-if="isTyping" class="typing-indicator">
        <image :src="currentLover.avatar_image" class="avatar-small" />
        <view class="dots">
          <view class="dot" v-for="i in 3" :key="i"></view>
        </view>
      </view>
    </scroll-view>

    <!-- 建议选项（快捷回复） -->
    <view v-if="suggestedActions.length" class="suggestions">
      <view
        v-for="(action, index) in suggestedActions"
        :key="index"
        class="suggestion-chip"
        @click="sendMessage(action)"
      >
        {{ action }}
      </view>
    </view>

    <!-- 输入栏 -->
    <view class="input-bar">
      <input
        v-model="inputText"
        :placeholder="inputPlaceholder"
        confirm-type="send"
        @confirm="sendMessage(inputText)"
        :disabled="isTyping"
      />
      <button class="send-btn" @click="sendMessage(inputText)" :disabled="!inputText || isTyping">
        发送
      </button>
    </view>

    <!-- 字数不足弹窗 -->
    <ad-modal
      v-if="showAdModal"
      :lover-name="currentLover.name"
      @watch-ad="watchAd"
      @close="showAdModal = false"
    />

    <!-- 阶段转变动画 -->
    <stage-transition
      v-if="showStageTransition"
      :from-stage="previousStage"
      :to-stage="relationshipStage"
      :lover-name="currentLover.name"
      @complete="showStageTransition = false"
    />
  </view>
</template>

<script>
export default {
  data() {
    return {
      currentLover: {},
      messages: [],
      inputText: '',
      wordBalance: 800,
      favorability: 0,
      relationshipStage: 'stranger',
      isTyping: false,
      showAdModal: false,
      showStageTransition: false,
      previousStage: '',
      suggestedActions: [],
      scrollTop: 0
    };
  },

  computed: {
    stageLabel() {
      const labels = {
        stranger: '陌生人',
        acquaintance: '认识',
        familiar: '熟悉',
        friend: '好友',
        ambiguous: '暧昧',
        confessed: '表白',
        lover: '恋人',
        passionate: '热恋',
        married: '已婚',
        parent: '为人父母',
        growing_old: '白头偕老'
      };
      return labels[this.relationshipStage] || '陌生人';
    },
    inputPlaceholder() {
      return `对${this.currentLover.name}说些什么...`;
    }
  },

  methods: {
    async sendMessage(content) {
      if (!content?.trim()) return;
      this.inputText = '';

      // 检查字数
      if (this.wordBalance <= 0) {
        this.showAdModal = true;
        return;
      }

      // 添加用户消息
      this.messages.push({
        role: 'user',
        content: content.trim(),
        timestamp: new Date().toISOString()
      });
      this.scrollToBottom();

      // 显示打字动画
      this.isTyping = true;

      try {
        const res = await uniCloud.callFunction({
          name: 'chat-handler',
          data: {
            user_id: this.userId,
            lover_id: this.currentLover._id,
            user_message: content.trim()
          }
        });

        this.isTyping = false;

        if (res.result.code === 402) {
          this.showAdModal = true;
          return;
        }

        const data = res.result.data;

        // 添加AI回复
        this.messages.push({
          role: 'assistant',
          content: data.reply,
          timestamp: new Date().toISOString(),
          event_triggered: data.event_triggered
        });

        // 更新状态
        this.wordBalance = data.word_balance;
        this.suggestedActions = data.suggested_actions || [];

        // 检查关系阶段变化
        if (data.relationship_stage !== this.relationshipStage) {
          this.previousStage = this.relationshipStage;
          this.relationshipStage = data.relationship_stage;
          this.showStageTransition = true;
        }

        this.favorability = data.favorability;

        // 里程碑提示
        if (data.milestone) {
          this.showMilestoneToast(data.milestone);
        }

        this.scrollToBottom();
      } catch (err) {
        this.isTyping = false;
        uni.showToast({ title: '网络错误，请重试', icon: 'none' });
      }
    },

    async watchAd() {
      // #ifdef MP-WEIXIN
      const adComponent = uni.createRewardedVideoAd({
        adUnitId: 'your-wx-ad-unit-id'
      });
      // #endif

      // #ifdef MP-TOUTIAO
      const adComponent = tt.createRewardedVideoAd({
        adUnitId: 'your-tt-ad-unit-id'
      });
      // #endif

      adComponent.onClose(async (res) => {
        if (res && res.isEnded) {
          const result = await uniCloud.callFunction({
            name: 'ad-reward-handler',
            data: {
              user_id: this.userId,
              ad_type: 'watch_ad',
              ad_id: 'xxx'
            }
          });
          this.wordBalance = result.result.data.new_balance;
          this.showAdModal = false;
          uni.showToast({ title: `获得500字！`, icon: 'success' });
        }
      });

      adComponent.show();
    },

    scrollToBottom() {
      this.$nextTick(() => {
        this.scrollTop = 999999;
      });
    }
  }
};
</script>
```

---

## 七、广告变现策略

### 7.1 广告触发点

| 触发场景 | 广告类型 | 奖励 | 频率 |
|---------|---------|------|------|
| 字数不足时 | 激励视频 | 500字 | 按需 |
| 更换恋人 | 激励视频 | 解锁更换 | 按需 |
| 被拉黑后道歉 | 激励视频 | 道歉机会+200字 | 按需 |
| 解锁特殊事件 | 激励视频 | 300字+事件 | 每阶段1-2次 |
| 查看回忆相册 | 插屏广告 | 免费查看 | 每次进入 |
| 每日签到翻倍 | 激励视频 | 双倍每日字数(160字) | 每日1次 |
| 加速好感度 | 激励视频 | 好感度+30 | 每日3次 |

### 7.2 广告展示原则

```
核心原则：
1. 不强制看广告，但强烈激励（字数是硬需求）
2. 每次广告有明确的、有价值的回报
3. 不在对话过程中插入广告（影响沉浸感）
4. 广告入口自然融入游戏UI
```

---

## 八、恋人更换系统

### 8.1 更换规则

```
更换恋人条件：
1. 观看1次激励视频广告
2. 当前恋人进度会被保存（可以后续切回）
3. 切换后继续之前的进度（如果有）或从陌生人开始

特殊情况：
- 恋人已"死亡"：免费选择新恋人
- 被恋人"拉黑"：需看广告获得道歉机会，或更换恋人
- 同时只能攻略1位恋人

数据处理：
- 切换时，当前对话上下文存入 game_progress 的 chat_summary
- 切回时，从 chat_summary 恢复上下文
- 历史对话记录永久保存在 chats 集合
```

---

## 九、人生阶段剧情设计

### 9.1 婚后生活剧情线

```
结婚后 → 蜜月期（甜蜜日常）
  → 1年婚姻（第一次争吵与和好）
  → 3年婚姻（怀孕/生子事件）
  → 5年婚姻（育儿烦恼、职业发展）
  → 10年婚姻（婚姻危机/第二春事件）
  → 15年婚姻（孩子上学、中年危机）
  → 20年婚姻（孩子离家、空巢期）
  → 25年婚姻（银婚纪念）
  → 30年婚姻（退休生活、含饴弄孙）
  → 40年婚姻（金婚纪念）
  → 终章：白头偕老 / 恋人因病离世 / 平静离世
```

### 9.2 死亡事件设计

```
恋人死亡触发条件（随机，婚龄≥30年后概率增加）：
- 30年婚姻后：每次对话5%概率触发健康事件
- 40年婚姻后：每次对话15%概率触发
- 50年婚姻后：必定触发终章

死亡剧情流程：
1. 恋人提到身体不舒服（伏笔阶段，2-3轮对话）
2. 确诊事件（悲伤阶段）
3. 陪伴治疗（3-5轮对话）
4. 最后的时光（感人告别）
5. 恋人离世（终章CG/特殊文案）
6. 弹出选项："回忆相册" / "选择新的恋人" / "从头再来"
```

---

## 十、防无聊聊天机制

### 10.1 对话质量引导

```
大模型内置规则：

1. 闲聊计数器：连续3轮无实质内容的闲聊后，
   AI主动抛出事件/话题/情境选择

2. 剧情推动器：每8-12轮对话，自动插入一个
   与当前阶段匹配的剧情事件

3. 情绪波动：AI不会一直"好好好"，会有自己的
   情绪变化，制造戏剧冲突

4. 定期里程碑：到达特定对话轮数/天数时，
   自动触发阶段性事件

5. NPC介入：偶尔引入第三方角色（室友、同事、
   前任等）制造剧情张力

6. 选择驱动：AI会给出2-3个建议选项，
   引导玩家做出有意义的选择
```

### 10.2 防刷机制

```
- 连续发送相同内容：AI提示"你已经说过了哦"
- 发送无意义内容（如"啊啊啊"）：AI表达困惑，好感度-5
- 发送违规内容：AI拒绝回应，好感度-20
- 短时间内大量发送：触发频率限制（30秒冷却）
```

---

## 十一、UI/UX 设计指引

### 11.1 视觉风格

```
整体风格：温馨、清新、日系恋爱游戏风
主色调：
  - 男性视角主题色：#FF6B8A（粉红系）
  - 女性视角主题色：#6B8AFF（蓝紫系）

对话界面：
  - 仿即时通讯界面（类微信聊天）
  - AI恋人头像在左侧，玩家在右侧
  - 气泡颜色区分
  - 背景可随关系阶段变化（从冷色到暖色）

动效：
  - 好感度变化时数字跳动 + 爱心特效
  - 阶段升级全屏庆祝动画
  - 恋人眨眼视频循环播放（选人界面）
```

### 11.2 音效设计

```
- 收到消息提示音（温柔叮咚声）
- 好感度上升音效（清脆升调）
- 好感度下降音效（低沉降调）
- 阶段升级音效（庆祝音乐）
- BGM：轻柔钢琴/吉他背景音乐（可关闭）
```

---

## 十二、数据统计与运营

### 12.1 关键数据指标

```
用户维度：
- DAU / MAU
- 次日留存 / 7日留存 / 30日留存
- 平均每日对话轮数
- 平均每日广告观看次数
- ARPU（每用户平均广告收入）

内容维度：
- 各恋人选择率
- 各阶段平均停留时间
- 表白成功率
- 结婚达成率
- 完整通关率（白头偕老）

变现维度：
- 广告点击率
- 广告完成率
- 各触发点广告转化率
- eCPM（有效千次展示收入）
```

### 12.2 运营活动

```
1. 七夕/情人节特别剧情事件
2. 新恋人角色定期上线
3. 限时好感度加倍活动
4. 节日限定CG/场景
5. 排行榜：最快表白成功、最长婚姻等
```

---

## 十三、合规与安全

### 13.1 内容安全

```
1. 大模型 System Prompt 中强制设定安全红线
2. 关键词过滤：输入/输出双向过滤
3. 内容审核云函数：对AI输出进行二次校验
4. 举报机制：用户可举报不当内容
5. 年龄门槛：建议18+标注
```

### 13.2 数据隐私

```
1. 遵循《个人信息保护法》
2. 最小必要原则收集用户数据
3. 对话数据加密存储
4. 用户可申请删除所有数据
5. 隐私政策与用户协议前置展示
```

---

## 十四、开发排期建议

| 阶段 | 内容 | 预计工期 |
|------|------|---------|
| P0-设计 | 策划案细化、UI设计稿、角色素材制作 | 2周 |
| P1-基础框架 | uni-app项目搭建、UniCloud配置、数据库设计 | 1周 |
| P2-核心功能 | 性别选择、恋人画廊、对话界面、大模型调用 | 3周 |
| P3-系统功能 | 好感度系统、事件系统、阶段转换、字数系统 | 2周 |
| P4-变现接入 | 微信/抖音广告SDK接入、激励视频逻辑 | 1周 |
| P5-多平台适配 | 微信小游戏 & 抖音小游戏 适配调试 | 1周 |
| P6-测试优化 | 功能测试、性能优化、体验优化 | 2周 |
| P7-上线 | 提交审核、灰度发布、正式上线 | 1周 |
| **合计** | | **约13周（3个月）** |

---

## 十五、成本预估

| 项目 | 月成本预估 | 说明 |
|------|-----------|------|
| UniCloud云服务 | ¥200-500 | 按量付费，初期用户少时很低 |
| 大模型API调用 | ¥1000-5000 | 按DAU 1000估算，DeepSeek约¥0.5-2/千次 |
| 角色素材制作 | ¥5000-15000（一次性） | 12个角色的立绘+眨眼视频 |
| UI设计 | ¥3000-8000（一次性） | 界面设计稿 |
| **月运营成本** | **¥1200-5500** | 不含人力 |

---

