#《这些年我们追过的AI恋人》— 完整游戏策划案文档
# 游戏设计文字介绍：
      调用大模型，用uni-app开发一款抖音小游戏和微信小游戏，用unicloud作为数据库，实现关键数据的云存储，调用大模型，实现自由输入，展开剧情，同时设定整体剧情，设定数值约束，设定规则，设定目标，防止只是无聊的漫无目的的聊天，游戏名字叫这些年我们追过的AI恋人，游戏初始需要确定玩家性别，然后展示多个性格各异和形象各异的异性恋人图片或者2秒带眨眼的循环视频（本地提供，不随机生成），作为异性恋人的形象展示，
   玩家选择其中一个开始游玩，支持自由聊天，开发剧情，追求Ai恋人，AI恋人最初设定为陌生人，设定好感度，通过交流提升或者减少好感度，由陌生人，变成认识，变成熟悉，变成好友，变得暧昧，表白成为正式恋人，谈恋爱，结婚，生子，婚后生活，10年婚姻，20年婚姻，30年婚姻，如此重复下去/或者设定AI恋人的死亡，玩家可以重新选择一个恋人进行游玩。玩家中途也可以更改恋人，需要看广告，游戏纯靠广告变现，游戏初始赠送1000字，每日赠送100字，
   AI每次生成的字数都会扣除字数，字数不够，AI无法交流，需要看广告获得字数，看一次广告获得1000字数（可以更改，帮我设定合理数值，包括赠送的字数。）游戏界面为异性形象展示铺满整个屏幕，最底部为输入聊天框，聊天框上面展示对话内容，
---

## 📋 目录

1. [游戏概述](#1-游戏概述)
2. [技术架构](#2-技术架构)
3. [核心玩法设计](#3-核心玩法设计)
4. [角色系统](#4-角色系统)
5. [好感度与关系系统](#5-好感度与关系系统)
6. [剧情系统](#6-剧情系统)
7. [经济系统（字数 & 广告）](#7-经济系统)
8. [UI/UX 设计](#8-uiux-设计)
9. [数据库设计（UniCloud）](#9-数据库设计unicloud)
10. [大模型调用方案](#10-大模型调用方案)
11. [商业化方案](#11-商业化方案)
12. [项目目录结构](#12-项目目录结构)
13. [关键代码实现](#13-关键代码实现)
14. [开发排期建议](#14-开发排期建议)

---

## 1. 游戏概述

| 项目 | 描述 |
|------|------|
| **游戏名称** | 这些年我们追过的AI恋人 |
| **游戏类型** | AI互动恋爱养成 / 文字冒险 |
| **目标平台** | 微信小游戏、抖音小游戏 |
| **开发框架** | uni-app (Vue3 + TypeScript) |
| **后端服务** | UniCloud (云函数 + 云数据库) |
| **AI引擎** | 大语言模型 API（DeepSeek / 通义千问 / GLM等） |
| **盈利模式** | 纯广告变现（激励视频广告） |
| **目标用户** | 18-35岁，对恋爱养成、AI互动感兴趣的男女用户 |
| **游戏定位** | 轻量级、高情感沉浸、可反复体验的AI恋爱模拟器 |

### 1.1 核心卖点
- **真正的自由对话**：不是选择题，而是自由输入，AI实时回应
- **深度情感模拟**：从陌生人到白头偕老的完整人生体验
- **多角色多线路**：多个性格迥异的AI恋人可选，每次体验都不同
- **有目标有约束**：不是漫无目的聊天，有明确的关系进展阶梯和生命事件

---

## 2. 技术架构

```
┌─────────────────────────────────────────────────────┐
│                   客户端 (uni-app)                    │
│  ┌──────────┐  ┌──────────┐  ┌───────────────────┐  │
│  │ 微信小游戏 │  │ 抖音小游戏 │  │  H5 (调试用)     │  │
│  └──────────┘  └──────────┘  └───────────────────┘  │
└────────────────────┬────────────────────────────────┘
                     │ HTTPS
┌────────────────────▼────────────────────────────────┐
│               UniCloud 云服务                        │
│  ┌──────────────────────────────────────────────┐   │
│  │           云函数 (Cloud Functions)             │   │
│  │  ┌────────────┐ ┌────────────┐ ┌──────────┐  │   │
│  │  │ chat-engine│ │ user-mgmt  │ │ ad-reward│  │   │
│  │  │ (AI对话核心)│ │ (用户管理)  │ │(广告奖励) │  │   │
│  │  └─────┬──────┘ └────────────┘ └──────────┘  │   │
│  │        │                                      │   │
│  │  ┌─────▼──────┐ ┌────────────┐ ┌──────────┐  │   │
│  │  │ story-ctrl │ │ relation   │ │ daily    │  │   │
│  │  │ (剧情控制)  │ │ (关系系统)  │ │(每日任务) │  │   │
│  │  └────────────┘ └────────────┘ └──────────┘  │   │
│  └──────────────────────────────────────────────┘   │
│  ┌──────────────────────────────────────────────┐   │
│  │         云数据库 (MongoDB)                     │   │
│  │  users | characters | chat_history |          │   │
│  │  relationships | game_state | word_balance    │   │
│  └──────────────────────────────────────────────┘   │
└─────────────────────┬───────────────────────────────┘
                      │ HTTPS
┌─────────────────────▼───────────────────────────────┐
│            大模型 API 服务                            │
│  (DeepSeek / 通义千问 / GLM-4 等)                     │
└─────────────────────────────────────────────────────┘
```

---

## 3. 核心玩法设计

### 3.1 游戏流程总览

```
开始游戏
  │
  ▼
选择玩家性别（男/女）
  │
  ▼
展示异性恋人候选列表（6-8个角色）
  │  每个角色有：头像/循环视频 + 姓名 + 一句话性格标签
  ▼
选择一个恋人 → 进入游戏主界面
  │
  ▼
┌─────────────────────────────────────┐
│          核心游戏循环                 │
│                                     │
│  全屏恋人形象 + 底部聊天界面          │
│         │                           │
│  玩家自由输入文字 ──► 扣除字数        │
│         │                           │
│  AI生成回复 ──► 扣除生成字数          │
│         │                           │
│  更新好感度 / 触发剧情事件            │
│         │                           │
│  关系阶段推进 / 生命事件触发          │
│         │                           │
│  字数不足 → 看广告补充               │
└─────────────────────────────────────┘
  │
  ▼
结局（白头偕老/恋人离世/分手等）
  │
  ▼
可重新选择恋人开始新游戏
```

### 3.2 玩家操作方式

| 操作 | 说明 |
|------|------|
| **自由输入** | 底部输入框，发送任意文字与AI恋人交流 |
| **查看关系面板** | 点击恋人头像查看好感度、关系阶段、纪念日等 |
| **切换恋人** | 侧栏菜单，需看1次广告（中途更换） |
| **查看字数余额** | 右上角实时显示剩余字数 |
| **看广告** | 主动看广告获取字数 |
| **查看回忆录** | 重要剧情节点的回顾 |

### 3.3 游戏规则约束（防止漫无目的聊天）

#### 3.3.1 目标系统
每个关系阶段有**明确的阶段目标**，引导玩家推动剧情：

| 关系阶段 | 目标提示 | 达成条件 |
|----------|----------|----------|
| 陌生人 | "试着打个招呼吧" | 好感度≥10 |
| 认识 | "多了解对方的兴趣爱好" | 好感度≥25，对话≥10轮 |
| 熟悉 | "找个理由约Ta出来" | 好感度≥40，触发约会事件 |
| 好友 | "在Ta需要时给予支持" | 好感度≥55，完成1次情感支持事件 |
| 暧昧 | "制造浪漫的氛围" | 好感度≥70，触发暧昧事件 |
| 表白 | "找到合适的时机表达心意" | 好感度≥80，玩家主动表白 |
| 恋人 | "一起创造美好回忆" | 好感度≥85，经历3次约会事件 |
| 结婚 | "给Ta一个承诺" | 好感度≥92，触发求婚事件 |
| 婚后 | "经营你们的小家" | 持续互动，处理生活事件 |

#### 3.3.2 数值约束系统

```
┌────────────────────────────────────────────┐
│              数值约束面板                    │
├────────────────────────────────────────────┤
│  好感度：0-100（核心驱动数值）               │
│  信任度：0-100（影响深层对话解锁）           │
│  亲密度：0-100（影响肢体互动、同居等）       │
│  倦怠值：0-100（过高导致冷战/分手风险）      │
│  新鲜感：0-100（鼓励玩家多样化互动）         │
│  日期：游戏内时间流逝                        │
└────────────────────────────────────────────┘
```

**数值变化规则：**
- 正面互动（关心、幽默、浪漫）→ 好感度+1~5、亲密度+1~3
- 负面互动（冷漠、粗鲁、不尊重）→ 好感度-3~10、信任度-2~5
- 长时间不聊天（>24h真实时间）→ 新鲜感-5、倦怠值+3
- 重复无意义内容 → 新鲜感-3、倦怠值+2
- 触发剧情事件正确应对 → 大幅提升对应数值

#### 3.3.3 规则约束（大模型System Prompt内嵌）

1. **话题引导**：AI恋人会主动发起话题、提出要求、表达情绪，而非被动回应
2. **情绪波动**：AI恋人有自己的情绪周期，有时开心有时低落
3. **事件触发**：达到特定条件自动触发剧情事件（生日、节日、冲突等）
4. **拒绝机制**：好感度不足时，某些行为会被AI拒绝
5. **分手机制**：好感度降至0以下或触发严重负面事件→关系破裂
6. **时间压力**：某些事件有时间限制（如"Ta看起来不开心，��不要关心一下？"）

---

## 4. 角色系统

### 4.1 女性恋人角色（男性玩家可选）

| 编号 | 姓名 | 性格标签 | 性格描述 | 形象关键词 | 难度 |
|------|------|----------|----------|------------|------|
| F01 | 苏晚晴 | 温柔学姐 | 温柔体贴、善解人意、喜欢文学，偶尔小脆弱 | 长发、白裙、书卷气 | ★★☆ |
| F02 | 林可可 | 元气少女 | 活泼开朗、话多、喜欢冒险，容易吃醋 | 短发、运动装、阳光笑容 | ★★☆ |
| F03 | 沈冰瑶 | 冰山美人 | 外冷内热、高冷话少、极其专一，需要耐心融化 | 黑长直、职业装、清冷气质 | ★★★★ |
| F04 | 赵小鹿 | 邻家女孩 | 可爱害羞、喜欢烹饪和小动物，容易脸红 | 双马尾、围裙、甜美 | ★★☆ |
| F05 | 陈诗雨 | 文艺女青年 | 多愁善感、喜欢音乐和画画，情绪起伏较大 | 卷发、贝雷帽、帆布包 | ★★★☆ |
| F06 | 周妍妍 | 霸道女总裁 | 强势独立、工作狂、但渴望被呵护 | 短发干练、西装、高跟鞋 | ★★★★★ |

### 4.2 男性恋人角色（女性玩家可选）

| 编号 | 姓名 | 性格标签 | 性格描述 | 形象关键词 | 难度 |
|------|------|----------|----------|------------|------|
| M01 | 顾南城 | 温柔学长 | 温文尔雅、细心体贴、会做饭，默默守护型 | 眼镜、白衬衫、书生气 | ★★☆ |
| M02 | 陆战 | 阳光男孩 | 运动型、正能量、有点直男但很真诚 | 短发、篮球服、阳光 | ★★☆ |
| M03 | 萧逸寒 | 高冷男神 | 话少面冷心热、学霸、不善表达但行动派 | 黑色卫衣、耳机、冷峻 | ★★★★ |
| M04 | 林屿 | 邻家男孩 | 开朗幽默、段子手、总能逗你开心 | 卫衣、背包、邻家感 | ★★☆ |
| M05 | 秦墨 | 文艺青年 | 弹吉他、写诗、浪漫但有时不切实际 | 长发微卷、吉他、围巾 | ★★★☆ |
| M06 | 叶知秋 | 霸道总裁 | 强势多金、说一不二、但对爱人例外 | 西装、名表、气场 | ★★★★★ |

### 4.3 角色资源规格

每个角色需准备以下本地资源：

| 资源类型 | 规格 | 用途 |
|----------|------|------|
| 立绘全身图 | 1080×1920px, WebP | 游戏主界面背景 |
| 头像 | 200×200px, WebP | 聊天气泡、选人界面 |
| 眨眼循环视频 | 1080×1920px, 2秒, MP4/WebM | 主界面动态展示 |
| 表情变化图(可选) | 1080×1920px, WebP × 5张 | 不同情绪切换 |
| 选人展示卡 | 400×600px, WebP | 角色选择界面 |

表情变化图（5种状态）：
- 😊 开心（好感度高 / 正面互动）
- 😐 普通（默认状态）
- 😢 难过（负面事件 / 冷落）
- 😠 生气（严重负面互动）
- 😳 害羞（暧昧/表白/亲密互动）

---

## 5. 好感度与关系系统

### 5.1 关系阶段详细设计

```
阶段0: 陌生人      好感度 [0, 10)     ── 初始状态，AI表现冷淡客套
  │  ↓ 好感度≥10
阶段1: 认识        好感度 [10, 25)    ── 知道名字，偶尔聊天
  │  ↓ 好感度≥25 + 对话≥10轮
阶段2: 熟悉        好感度 [25, 40)    ── 经常聊天，分享日常
  │  ↓ 好感度≥40 + 触发约会事件
阶段3: 好友        好感度 [40, 55)    ── 互相信任，无话不谈
  │  ↓ 好感度≥55 + 完成情感支持事件
阶段4: 暧昧        好感度 [55, 70)    ── 暗送秋波，小暧昧
  │  ↓ 好感度≥70 + 触发暧昧事件
阶段5: 表白/被表白  好感度≥80         ── 正式表白（可成功/失败）
  │  ↓ 表白成功
阶段6: 恋人        好感度 [80, 90)    ── 甜蜜恋爱期
  │  ↓ 好感度≥90 + 恋爱≥30天(游戏日)
阶段7: 求婚        好感度≥92          ── 求婚事件触发
  │  ↓ 求婚成功
阶段8: 新婚        好感度 [92, 95)    ── 新婚燕尔
  │  ↓ 游戏时间推进
阶段9: 育儿        好感度 [85, 100]   ── 生子、养育孩子
  │  ↓ 游戏时间推进
阶段10: 10年婚姻   好感度维护         ── 七年之痒已过，考验感情
  │  ↓ 游戏时间推进
阶段11: 20年婚姻   好感度维护         ── 孩子长大，空巢期
  │  ↓ 游戏时间推进
阶段12: 30年婚姻   好感度维护         ── 银婚，回忆往昔
  │  ↓ 游戏时间推进
阶段13: 白头偕老/生离死别             ── 最终结局
```

### 5.2 好感度变化规则表

| 玩家行为类型 | 好感度变化 | 信任度变化 | 亲密度变化 | 倦怠值变化 |
|------------|-----------|-----------|-----------|-----------|
| 真诚关心 | +2~4 | +1~2 | +1 | -1 |
| 幽默风趣 | +1~3 | 0 | +1 | -2 |
| 浪漫行为 | +3~5 | +1 | +2~3 | -3 |
| 分享心事 | +1~2 | +2~3 | +1 | -1 |
| 记住重要日期 | +5~8 | +3 | +2 | -2 |
| 冷漠回应 | -2~4 | -1 | -1 | +2 |
| 粗鲁言语 | -5~10 | -3~5 | -2 | +5 |
| 频繁骚扰 | -3~6 | -2 | 0 | +5 |
| 长时间不理 | -1/天 | -1/天 | -1/天 | +2/天 |
| 重复无聊内容 | -1 | 0 | 0 | +3 |
| 对事件正确应对 | +5~15 | +3~5 | +2~5 | -5 |
| 对事件错误应对 | -5~15 | -3~5 | -2~3 | +5 |

### 5.3 关系特殊事件

| 事件类型 | 触发条件 | 描述 |
|----------|----------|------|
| 偶遇事件 | 阶段1，随机 | AI恋人"偶遇"玩家，开启新话题 |
| 求助事件 | 阶段2，好感≥30 | AI恋人遇到困难向玩家求助 |
| 约会邀请 | 阶段2-3，好感≥35 | 一方邀请另一方出去 |
| 误会冲突 | 阶段3+，随机 | 产生误会，考验处理能力 |
| 暧昧信号 | 阶段4，好感≥60 | AI恋人释放暧昧信号 |
| 情敌出现 | 阶段4-5，随机 | 出现竞争者，制造紧张感 |
| 表白时机 | 阶段5，好感≥78 | 氛围到了，可以表白 |
| 纪念日 | 恋爱后每30天 | 周年纪念日，忘记会扣好感 |
| 家人见面 | 阶段6，好感≥88 | 见家长事件 |
| 求婚 | 阶段7，好感≥92 | 求婚大事件 |
| 婚礼 | 求婚成功后 | 婚礼场景 |
| 怀孕/生子 | 婚后，好感≥88 | 家庭新成员 |
| 七年之痒 | 婚后7年 | 感情考验 |
| 中年危机 | 婚后15年 | 重大人生选择 |
| 孩子离家 | 婚后20年 | 空巢期适应 |
| 健康危机 | 婚后25年+，随机 | 生死考验 |
| 金婚 | 婚后50年 | 终极结局 |

---

## 6. 剧情系统

### 6.1 剧情框架（System Prompt 核心设定）

大模型在每次对话时会接收以下结构化的System Prompt：

```
你是一个恋爱养成游戏中的AI恋人角色。

【角色设定】
- 姓名：{character_name}
- 性格：{character_personality}
- 说话风格：{character_speech_style}
- 兴趣爱好：{character_hobbies}
- 背景故事：{character_backstory}

【当前状态】
- 关系阶段：{current_stage}（如：暧昧）
- 好感度：{favorability}/100
- 信任度：{trust}/100
- 亲密度：{intimacy}/100
- 倦怠值：{boredom}/100
- 新鲜感：{freshness}/100
- 当前情绪：{current_mood}
- 游戏内日期：{game_date}
- 已交往天数：{days_together}

【行为规则】
1. 你必须始终以{character_name}的身份回应，保持性格一致性
2. 根据当前好感度调整你的态度：
   - 好感度<20：冷淡、客套、保持距离
   - 好感度20-40：友善但保持边界
   - 好感度40-60：热情、愿意分享
   - 好感度60-80：会主动关心、偶尔撒娇/暧昧
   - 好感度>80：深情、依赖、甜蜜
3. 你要主动推进剧情，不要只是被动回答
4. 每隔3-5轮对话主动发起新话题或事件
5. 如果玩家连续发送无意义内容，表达不满或转移话题
6. 如果玩家行为不当，根据性格做出相应反应（生气/难过/冷战）
7. 重要：不要直接告诉玩家数值变化，要通过语气和内容间接体现

【当前需要触发的事件】
{pending_event_description}（如果有）

【对话历史摘要】
{conversation_summary}

【输出格式要求】
请以JSON格式输出：
{
  "reply": "角色的回复文本",
  "mood": "当前情绪(happy/normal/sad/angry/shy)",
  "favorability_change": 数值(-10到+10),
  "trust_change": 数值(-5到+5),
  "intimacy_change": 数值(-5到+5),
  "boredom_change": 数值(-5到+5),
  "freshness_change": 数值(-5到+5),
  "event_triggered": "触发的事件名称或null",
  "stage_hint": "是否建议推进到下一阶段(yes/no)"
}
```

### 6.2 剧情事件脚本模板

每个事件有预设的触发条件和分支：

```json
{
  "event_id": "EVT_CONFESSION",
  "event_name": "表白时刻",
  "trigger_conditions": {
    "min_favorability": 78,
    "min_stage": "暧昧",
    "min_interactions": 50
  },
  "description": "夕阳西下，你们一起在公园散步，氛围刚刚好...",
  "branches": [
    {
      "type": "success",
      "condition": "favorability >= 80 && 玩家表达真诚",
      "result": "表白成功，进入恋人阶段",
      "favorability_bonus": 10
    },
    {
      "type": "partial",
      "condition": "favorability >= 75 && 表达一般",
      "result": "对方说需要时间考虑",
      "favorability_bonus": 3
    },
    {
      "type": "failure",
      "condition": "favorability < 75 || 表达草率",
      "result": "被委婉拒绝，关系短暂尴尬",
      "favorability_bonus": -5
    }
  ]
}
```

---

## 7. 经济系统

### 7.1 字数机制设计

| 项目 | 数值 | 说明 |
|------|------|------|
| **新手赠送** | 2000字 | 首次进入游戏赠送 |
| **每日赠送** | 200字 | 每天登录赠送（UTC+8 00:00刷新） |
| **连续登录加成** | +50字/天（上限+200） | 连续3天250字，7天+400字 |
| **看广告获得** | 800字/次 | 每次看完激励视频广告获得 |
| **每日广告上限** | 15次/天 | 防止过度观看，每天最多看15次 |
| **玩家发送扣除** | 按实际输入字数扣除 | 玩家每发一条消息扣除相应字数 |
| **AI回复扣除** | 按AI生成字数扣除 | AI每次回复扣除相应字数 |
| **单条消息上限** | 200字 | 玩家单条消息不超过200字 |
| **AI回复上限** | 300字 | AI单次回复控制在300字以内 |

### 7.2 字数经济平衡分析

```
假设每轮对话：玩家发送30字 + AI回复80字 = 110字/轮

新手赠送2000字 ≈ 18轮对话（约可玩15-20分钟，足够体验到"认识"阶段）
每日赠送200字 ≈ 1.8轮对话（吊胃口，促使看广告）
看1次广告800字 ≈ 7轮对话（约5-8分钟）

目标：让玩家每天看3-5次广告 → 每天约2400-4000字 → 约25-40轮对话
```

### 7.3 特殊字数活动

| 活动 | 奖励 |
|------|------|
| 首次选择恋人 | +500字 |
| 达成新关系阶段 | +300字 |
| 完成剧情事件 | +200字 |
| 连续7天登录 | +1000字 |
| 分享游戏到社交平台 | +500字 |
| 邀请好友 | +800字/人 |

---

## 8. UI/UX 设计

### 8.1 界面布局

```
┌─────────────────────────────────┐
│  [≡]          ❤️ 72    ✏️ 1580  │  ← 顶栏：菜单 | 好感度 | 剩余字数
│                                 │
│                                 │
│                                 │
│     ┌───────────────────┐       │
│     │                   │       │
│     │    恋人形象/视频    │       │  ← 恋人形象铺满屏幕
│     │    (全屏背景)       │       │
│     │                   │       │
│     │                   │       │
│     └───────────────────┘       │
│                                 │
│  ┌─────────────────────────┐    │
│  │ 💬 对话气泡区域          │    │  ← 半透明背景的对话气泡
│  │                         │    │     从下往上显示
│  │  [Ta]: 今天天气真好~      │    │
│  │                         │    │
│  │        你也觉得吗？ :[我] │    │
│  │                         │    │
│  │  [Ta]: 嗯！要不要一起     │    │
│  │       出去走走？😊        │    │
│  └─────────────────────────┘    │
│                                 │
│  ┌─────────────────────┐ [📤]  │  ← 输入框 + 发送按钮
│  │  说点什么吧...        │       │
│  └─────────────────────┘       │
└─────────────────────────────────┘
```

### 8.2 界面设计细节

| 元素 | 设计要求 |
|------|----------|
| **恋人背景** | 全屏展示，使用2秒循环眨眼视频或静态立绘 |
| **对话气泡区** | 占屏幕下半部分约40%，半透明黑色遮罩(opacity: 0.5) |
| **玩家气泡** | 右侧，主题色（蓝/粉色渐变）圆角矩形 |
| **恋人气泡** | 左侧，白色半透明圆角矩形，带恋人小头像 |
| **输入框** | 底部固定，圆角，浅色半透明背景 |
| **好感度心形** | 顶栏红色爱心+数字，点击展开关系面板 |
| **字数余额** | 顶栏笔图标+数字，不足500时变为红色闪烁 |
| **情绪变化** | 恋人形象根据mood切换不同表情图（渐变过渡） |
| **事件弹窗** | 触发重要剧情时全屏弹窗，带特效 |

### 8.3 页面列表

| 页面 | 路径 | 功能 |
|------|------|------|
| 启动页 | /pages/splash | Logo+加载动画 |
| 性别选择 | /pages/gender-select | 选择玩家性别 |
| 恋人选择 | /pages/character-select | 展示所有可选恋人 |
| 游戏主页 | /pages/game/chat | 核心聊天+恋人展示 |
| 关系面板 | /pages/game/relationship | 数值、阶段、纪念日 |
| 回忆录 | /pages/game/memories | 重要剧情回顾 |
| 字数商店 | /pages/shop/words | 看广告获取字数 |
| 设置 | /pages/settings | 音效、通知等设置 |
| 角色图鉴 | /pages/collection | 已解锁角色列表 |

---

## 9. 数据库设计（UniCloud）

### 9.1 数据表结构

#### users（用户表）
```json
{
  "_id": "用户唯一ID",
  "openid": "微信/抖音openid",
  "platform": "weixin | douyin",
  "gender": "male | female",
  "nickname": "玩家昵称",
  "avatar_url": "头像URL",
  "word_balance": 2000,
  "total_words_used": 0,
  "total_ads_watched": 0,
  "consecutive_login_days": 0,
  "last_login_date": "2026-02-27",
  "created_at": "2026-02-27T10:00:00Z",
  "updated_at": "2026-02-27T10:00:00Z",
  "settings": {
    "sound_enabled": true,
    "notification_enabled": true
  }
}
```

#### characters（角色配置表）
```json
{
  "_id": "F01",
  "name": "苏晚晴",
  "gender": "female",
  "personality_tag": "温柔学姐",
  "personality_detail": "温柔体贴、善解人意、喜欢文学...",
  "speech_style": "语气温柔，偶尔引用诗句，喜欢用'呢'结尾",
  "hobbies": ["阅读", "写日记", "逛书店", "喝茶"],
  "backstory": "中文系大三学生，校文学社社长...",
  "difficulty": 2,
  "assets": {
    "full_image": "/static/characters/F01/full.webp",
    "avatar": "/static/characters/F01/avatar.webp",
    "blink_video": "/static/characters/F01/blink.mp4",
    "mood_images": {
      "happy": "/static/characters/F01/happy.webp",
      "normal": "/static/characters/F01/normal.webp",
      "sad": "/static/characters/F01/sad.webp",
      "angry": "/static/characters/F01/angry.webp",
      "shy": "/static/characters/F01/shy.webp"
    }
  }
}
```

#### game_states（游戏存档表）
```json
{
  "_id": "自动生成",
  "user_id": "用户ID",
  "character_id": "F01",
  "status": "active | archived | ended",
  "relationship_stage": "暧昧",
  "stage_index": 4,
  "favorability": 65,
  "trust": 58,
  "intimacy": 42,
  "boredom": 15,
  "freshness": 70,
  "current_mood": "happy",
  "game_date": "2026-06-15",
  "days_together": 45,
  "total_interactions": 128,
  "events_completed": ["EVT_FIRST_MEET", "EVT_FIRST_DATE", "EVT_HELP_REQUEST"],
  "pending_events": ["EVT_RIVAL_APPEARS"],
  "milestones": [
    {"type": "stage_up", "stage": "认识", "date": "2026-03-05", "summary": "你们在图书馆相识"},
    {"type": "stage_up", "stage": "熟悉", "date": "2026-03-20", "summary": "开始每天都聊天"}
  ],
  "conversation_summary": "最近在讨论周末计划，Ta提到想去看电影...",
  "created_at": "2026-02-27T10:00:00Z",
  "updated_at": "2026-02-27T15:30:00Z"
}
```

#### chat_histories（聊天记录表）
```json
{
  "_id": "自动生成",
  "user_id": "用户ID",
  "game_state_id": "存档ID",
  "character_id": "F01",
  "messages": [
    {
      "role": "user",
      "content": "今天过得怎么样？",
      "timestamp": "2026-02-27T15:30:00Z",
      "word_count": 7
    },
    {
      "role": "assistant",
      "content": "还不错呢～今天在图书馆看了一下午的书...",
      "timestamp": "2026-02-27T15:30:05Z",
      "word_count": 45,
      "mood": "happy",
      "value_changes": {
        "favorability": 2,
        "trust": 1
      }
    }
  ],
  "session_date": "2026-02-27",
  "message_count": 2,
  "total_words": 52
}
```

#### word_transactions（字数流水表）
```json
{
  "_id": "自动生成",
  "user_id": "用户ID",
  "type": "earn | spend",
  "source": "initial_gift | daily_gift | ad_reward | login_streak | chat_send | chat_receive | event_reward | share_reward",
  "amount": 800,
  "balance_after": 2580,
  "details": "观看广告获得字数",
  "created_at": "2026-02-27T15:00:00Z"
}
```

#### ad_records（广告记录表）
```json
{
  "_id": "自动生成",
  "user_id": "用户ID",
  "ad_type": "reward_video | interstitial",
  "ad_purpose": "get_words | change_lover | unlock_feature",
  "platform": "weixin | douyin",
  "reward_amount": 800,
  "watched_at": "2026-02-27T15:00:00Z",
  "daily_count": 3
}
```

### 9.2 数据库索引设计

```javascript
// users 表索引
db.collection('users').createIndex({ openid: 1, platform: 1 }, { unique: true })

// game_states 表索引
db.collection('game_states').createIndex({ user_id: 1, status: 1 })
db.collection('game_states').createIndex({ user_id: 1, character_id: 1 })

// chat_histories 表索引
db.collection('chat_histories').createIndex({ user_id: 1, game_state_id: 1, session_date: -1 })

// word_transactions 表索引
db.collection('word_transactions').createIndex({ user_id: 1, created_at: -1 })

// ad_records 表索引
db.collection('ad_records').createIndex({ user_id: 1, watched_at: -1 })
```

---

## 10. 大模型调用方案

### 10.1 调用架构

```
客户端 → 云函数(chat-engine) → 大模型API
                ↓
          预处理+后处理
          ├── 构建System Prompt
          ├── 注入角色设定+数值状态
          ├── 压缩历史对话（节省token）
          ├── 解析AI返回的JSON
          ├── 更新数值到数据库
          └── 返回纯文本回复给客户端
```

### 10.2 Token优化策略

| 策略 | 说明 |
|------|------|
| **对话摘要** | 每20轮对话自动生成摘要，替代完整历史 |
| **滑动窗口** | 只发送最近10轮完整对话 + 之前的摘要 |
| **精简Prompt** | System Prompt模板化，变量注入 |
| **限制回复长度** | max_tokens设为400（约300中文字） |
| **缓存角色设定** | 角色基础设定缓存在云函数内存中 |

### 10.3 推荐大模型选择

| 模型 | 优势 | 估算成本 | 推荐度 |
|------|------|----------|--------|
| DeepSeek-V3 | 中文优秀、成本低 | ¥1/百万tokens | ⭐⭐⭐⭐⭐ |
| 通义千问-Max | 阿里云生态、稳定 | ¥2/百万tokens | ⭐⭐⭐⭐ |
| GLM-4-Flash | 免费额度大 | 免费/¥1百万tokens | ⭐⭐⭐⭐ |
| 文心一言 | 中文理解强 | ¥4/百万tokens | ⭐⭐⭐ |

---

## 11. 商业化方案

### 11.1 广告场景设计

| 广告场景 | 广告类型 | 触发时机 | 奖励 |
|----------|----------|----------|------|
| 获取字数 | 激励视频 | 字数不足时/主动点击 | 800字 |
| 更换恋人 | 激励视频 | 中途切换恋人 | 解锁切换 |
| 查看回忆 | 插屏广告 | 打开回忆录页面 | - |
| 解锁结局 | 激励视频 | 查看完整结局动画 | 结局解锁 |
| 每日签到加成 | 激励视频 | 签到时可选看广告 | 额外200字 |
| 加速事件 | 激励视频 | 等待事件冷却时 | 跳过冷却 |

### 11.2 收入预估模型

```
假设：
- DAU（日活）: 10,000
- 人均看广告次数: 4次/天
- 激励视频eCPM: ¥50（微信小游戏平均水平）
- 插屏广告eCPM: ¥20

日收入 = 10000 × 4 × 50 / 1000 = ¥2,000/天
月收入 ≈ ¥60,000/月

随着用户增长和优化：
- DAU 50,000 → 月收入 ≈ ¥300,000
- DAU 100,000 → 月收入 ≈ ¥600,000
```

---

## 12. 项目目录结构

```
ai-lover-game/
├── package.json
├── manifest.json                    # uni-app 配置
├── pages.json                       # 页面路由配置
├── App.vue                          # 应用入口
├── main.js                          # 主入口
├── uni.scss                         # 全局样��变量
│
├── pages/                           # 页面
│   ├── splash/                      # 启动页
│   │   └── index.vue
│   ├── gender-select/               # 性别选择
│   │   └── index.vue
│   ├── character-select/            # 恋人选择
│   │   └── index.vue
│   ├── game/                        # 游戏核心
│   │   ├── chat.vue                 # 主聊天页面
│   │   ├── relationship.vue         # 关系面板
│   │   └── memories.vue             # 回忆录
│   ├── shop/
│   │   └── words.vue                # 字数商店
│   ├── settings/
│   │   └── index.vue                # 设置
│   └── collection/
│       └── index.vue                # 角色图鉴
│
├── components/                      # 组件
│   ├── ChatBubble.vue               # 聊天气泡
│   ├── CharacterCard.vue            # 角色卡片
│   ├── RelationshipBar.vue          # 关系进度条
│   ├── EventPopup.vue               # 事件弹窗
│   ├── WordBalanceTag.vue           # 字数余额标签
│   ├── MoodIndicator.vue            # 情绪指示器
│   └── AdRewardButton.vue           # 广告奖励按钮
│
├── static/                          # 静态资源
│   ├── characters/                  # 角色资源
│   │   ├── F01/
│   │   │   ├── full.webp            # 全身立绘
│   │   │   ├── avatar.webp          # 头像
│   │   │   ├── blink.mp4            # 眨眼视频
│   │   │   ├── happy.webp           # 开心表情
│   │   │   ├── normal.webp          # 普通表情
│   │   │   ├── sad.webp             # 难过表情
│   │   │   ├── angry.webp           # 生气表情
│   │   │   └── shy.webp             # 害羞表情
│   │   ├── F02/ ...
│   │   ├── M01/ ...
│   │   └── ...
│   ├── images/                      # 通用图片
│   │   ├── logo.png
│   │   ├── bg-splash.webp
│   │   └── ...
│   └── audio/                       # 音效
│       ├── msg-send.mp3
│       ├── msg-receive.mp3
│       ├── event-trigger.mp3
│       └── bgm-romantic.mp3
│
├── store/                           # 状态管理 (Pinia)
│   ├── index.js
│   ├── user.js                      # 用户状态
│   ├── game.js                      # 游戏状态
│   └── chat.js                      # 聊天状态
│
├── utils/                           # 工具函数
│   ├── request.js                   # 云函数调用封装
│   ├── ad-manager.js                # 广告管理
│   ├── word-manager.js              # 字数管理
│   └── event-checker.js             # 事件触发检查
│
├── uniCloud-aliyun/                 # 云服务（阿里云）
│   ├── cloudfunctions/              # 云函数
│   │   ├── chat-engine/             # AI对话引擎
│   │   │   ├── index.js
│   │   │   ├── prompt-builder.js    # Prompt构建器
│   │   │   ├── value-updater.js     # 数值更新器
│   │   │   └── package.json
│   │   ├── user-mgmt/               # 用户管理
│   │   │   └── index.js
│   │   ├── ad-reward/               # 广告奖励
│   │   │   └── index.js
│   │   ├── daily-task/              # 每日任务
│   │   │   └── index.js
│   │   ├── game-state/              # 存档管理
│   │   │   └── index.js
│   │   └── story-controller/        # 剧情控制
│   │       ├── index.js
│   │       └── events.json          # 事件配置
│   │
│   └── database/                    # 数据库Schema
│       ├── users.schema.json
│       ├── characters.schema.json
│       ├── game_states.schema.json
│       ├── chat_histories.schema.json
│       ├── word_transactions.schema.json
│       └── ad_records.schema.json
│
└── platforms/                       # 平台特定配置
    ├── mp-weixin/                   # 微信小游戏
    └── mp-toutiao/                  # 抖音小游戏
```

---

